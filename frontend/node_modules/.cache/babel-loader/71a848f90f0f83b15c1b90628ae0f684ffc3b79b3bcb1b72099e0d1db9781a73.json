{"ast":null,"code":"import { matchNamePath } from \"../utils/valueUtil\";\n/**\n * Call action with delay in macro task.\n */\nconst macroTask = fn => {\n  const channel = new MessageChannel();\n  channel.port1.onmessage = fn;\n  channel.port2.postMessage(null);\n};\nexport default class WatcherCenter {\n  namePathList = [];\n  taskId = 0;\n  watcherList = new Set();\n  form;\n  constructor(form) {\n    this.form = form;\n  }\n  register(callback) {\n    this.watcherList.add(callback);\n    return () => {\n      this.watcherList.delete(callback);\n    };\n  }\n  notify(namePath) {\n    // Insert with deduplication\n    namePath.forEach(path => {\n      if (this.namePathList.every(exist => !matchNamePath(exist, path))) {\n        this.namePathList.push(path);\n      }\n    });\n    this.doBatch();\n  }\n  doBatch() {\n    this.taskId += 1;\n    const currentId = this.taskId;\n    macroTask(() => {\n      if (currentId === this.taskId && this.watcherList.size) {\n        const formInst = this.form.getForm();\n        const values = formInst.getFieldsValue();\n        const allValues = formInst.getFieldsValue(true);\n        this.watcherList.forEach(callback => {\n          callback(values, allValues, this.namePathList);\n        });\n        this.namePathList = [];\n      }\n    });\n  }\n}","map":{"version":3,"names":["matchNamePath","macroTask","fn","channel","MessageChannel","port1","onmessage","port2","postMessage","WatcherCenter","namePathList","taskId","watcherList","Set","form","constructor","register","callback","add","delete","notify","namePath","forEach","path","every","exist","push","doBatch","currentId","size","formInst","getForm","values","getFieldsValue","allValues"],"sources":["D:/ZSM/beachboys-concert/frontend/node_modules/@rc-component/form/es/hooks/useNotifyWatch.js"],"sourcesContent":["import { matchNamePath } from \"../utils/valueUtil\";\n/**\n * Call action with delay in macro task.\n */\nconst macroTask = fn => {\n  const channel = new MessageChannel();\n  channel.port1.onmessage = fn;\n  channel.port2.postMessage(null);\n};\nexport default class WatcherCenter {\n  namePathList = [];\n  taskId = 0;\n  watcherList = new Set();\n  form;\n  constructor(form) {\n    this.form = form;\n  }\n  register(callback) {\n    this.watcherList.add(callback);\n    return () => {\n      this.watcherList.delete(callback);\n    };\n  }\n  notify(namePath) {\n    // Insert with deduplication\n    namePath.forEach(path => {\n      if (this.namePathList.every(exist => !matchNamePath(exist, path))) {\n        this.namePathList.push(path);\n      }\n    });\n    this.doBatch();\n  }\n  doBatch() {\n    this.taskId += 1;\n    const currentId = this.taskId;\n    macroTask(() => {\n      if (currentId === this.taskId && this.watcherList.size) {\n        const formInst = this.form.getForm();\n        const values = formInst.getFieldsValue();\n        const allValues = formInst.getFieldsValue(true);\n        this.watcherList.forEach(callback => {\n          callback(values, allValues, this.namePathList);\n        });\n        this.namePathList = [];\n      }\n    });\n  }\n}"],"mappings":"AAAA,SAASA,aAAa,QAAQ,oBAAoB;AAClD;AACA;AACA;AACA,MAAMC,SAAS,GAAGC,EAAE,IAAI;EACtB,MAAMC,OAAO,GAAG,IAAIC,cAAc,CAAC,CAAC;EACpCD,OAAO,CAACE,KAAK,CAACC,SAAS,GAAGJ,EAAE;EAC5BC,OAAO,CAACI,KAAK,CAACC,WAAW,CAAC,IAAI,CAAC;AACjC,CAAC;AACD,eAAe,MAAMC,aAAa,CAAC;EACjCC,YAAY,GAAG,EAAE;EACjBC,MAAM,GAAG,CAAC;EACVC,WAAW,GAAG,IAAIC,GAAG,CAAC,CAAC;EACvBC,IAAI;EACJC,WAAWA,CAACD,IAAI,EAAE;IAChB,IAAI,CAACA,IAAI,GAAGA,IAAI;EAClB;EACAE,QAAQA,CAACC,QAAQ,EAAE;IACjB,IAAI,CAACL,WAAW,CAACM,GAAG,CAACD,QAAQ,CAAC;IAC9B,OAAO,MAAM;MACX,IAAI,CAACL,WAAW,CAACO,MAAM,CAACF,QAAQ,CAAC;IACnC,CAAC;EACH;EACAG,MAAMA,CAACC,QAAQ,EAAE;IACf;IACAA,QAAQ,CAACC,OAAO,CAACC,IAAI,IAAI;MACvB,IAAI,IAAI,CAACb,YAAY,CAACc,KAAK,CAACC,KAAK,IAAI,CAACzB,aAAa,CAACyB,KAAK,EAAEF,IAAI,CAAC,CAAC,EAAE;QACjE,IAAI,CAACb,YAAY,CAACgB,IAAI,CAACH,IAAI,CAAC;MAC9B;IACF,CAAC,CAAC;IACF,IAAI,CAACI,OAAO,CAAC,CAAC;EAChB;EACAA,OAAOA,CAAA,EAAG;IACR,IAAI,CAAChB,MAAM,IAAI,CAAC;IAChB,MAAMiB,SAAS,GAAG,IAAI,CAACjB,MAAM;IAC7BV,SAAS,CAAC,MAAM;MACd,IAAI2B,SAAS,KAAK,IAAI,CAACjB,MAAM,IAAI,IAAI,CAACC,WAAW,CAACiB,IAAI,EAAE;QACtD,MAAMC,QAAQ,GAAG,IAAI,CAAChB,IAAI,CAACiB,OAAO,CAAC,CAAC;QACpC,MAAMC,MAAM,GAAGF,QAAQ,CAACG,cAAc,CAAC,CAAC;QACxC,MAAMC,SAAS,GAAGJ,QAAQ,CAACG,cAAc,CAAC,IAAI,CAAC;QAC/C,IAAI,CAACrB,WAAW,CAACU,OAAO,CAACL,QAAQ,IAAI;UACnCA,QAAQ,CAACe,MAAM,EAAEE,SAAS,EAAE,IAAI,CAACxB,YAAY,CAAC;QAChD,CAAC,CAAC;QACF,IAAI,CAACA,YAAY,GAAG,EAAE;MACxB;IACF,CAAC,CAAC;EACJ;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}