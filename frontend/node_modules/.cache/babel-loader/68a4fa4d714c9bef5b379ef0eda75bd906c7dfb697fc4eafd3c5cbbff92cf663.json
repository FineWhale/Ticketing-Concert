{"ast":null,"code":"import { useEvent } from '@rc-component/util';\nimport useId from \"@rc-component/util/es/hooks/useId\";\nimport { useEffect, useMemo } from 'react';\nlet stack = [];\nconst IME_LOCK_DURATION = 200;\nlet lastCompositionEndTime = 0;\n\n// Export for testing\nexport const _test = process.env.NODE_ENV === 'test' ? () => ({\n  stack,\n  reset: () => {\n    // Not reset stack to ensure effect will clean up correctly\n    lastCompositionEndTime = 0;\n  }\n}) : null;\n\n// Global event handlers\nconst onGlobalKeyDown = event => {\n  if (event.key === 'Escape' && !event.isComposing) {\n    const now = Date.now();\n    if (now - lastCompositionEndTime < IME_LOCK_DURATION) {\n      return;\n    }\n    const len = stack.length;\n    for (let i = len - 1; i >= 0; i -= 1) {\n      stack[i].onEsc({\n        top: i === len - 1,\n        event\n      });\n    }\n  }\n};\nconst onGlobalCompositionEnd = () => {\n  lastCompositionEndTime = Date.now();\n};\nfunction attachGlobalEventListeners() {\n  window.addEventListener('keydown', onGlobalKeyDown);\n  window.addEventListener('compositionend', onGlobalCompositionEnd);\n}\nfunction detachGlobalEventListeners() {\n  if (stack.length === 0) {\n    window.removeEventListener('keydown', onGlobalKeyDown);\n    window.removeEventListener('compositionend', onGlobalCompositionEnd);\n  }\n}\nexport default function useEscKeyDown(open, onEsc) {\n  const id = useId();\n  const onEventEsc = useEvent(onEsc);\n  const ensure = () => {\n    if (!stack.find(item => item.id === id)) {\n      stack.push({\n        id,\n        onEsc: onEventEsc\n      });\n    }\n  };\n  const clear = () => {\n    stack = stack.filter(item => item.id !== id);\n  };\n  useMemo(() => {\n    if (open) {\n      ensure();\n    } else if (!open) {\n      clear();\n    }\n  }, [open]);\n  useEffect(() => {\n    if (open) {\n      ensure();\n      // Attach global event listeners\n      attachGlobalEventListeners();\n      return () => {\n        clear();\n        // Remove global event listeners if instances is empty\n        detachGlobalEventListeners();\n      };\n    }\n  }, [open]);\n}","map":{"version":3,"names":["useEvent","useId","useEffect","useMemo","stack","IME_LOCK_DURATION","lastCompositionEndTime","_test","process","env","NODE_ENV","reset","onGlobalKeyDown","event","key","isComposing","now","Date","len","length","i","onEsc","top","onGlobalCompositionEnd","attachGlobalEventListeners","window","addEventListener","detachGlobalEventListeners","removeEventListener","useEscKeyDown","open","id","onEventEsc","ensure","find","item","push","clear","filter"],"sources":["D:/ZSM/beachboys-concert/frontend/node_modules/@rc-component/portal/es/useEscKeyDown.js"],"sourcesContent":["import { useEvent } from '@rc-component/util';\nimport useId from \"@rc-component/util/es/hooks/useId\";\nimport { useEffect, useMemo } from 'react';\nlet stack = [];\nconst IME_LOCK_DURATION = 200;\nlet lastCompositionEndTime = 0;\n\n// Export for testing\nexport const _test = process.env.NODE_ENV === 'test' ? () => ({\n  stack,\n  reset: () => {\n    // Not reset stack to ensure effect will clean up correctly\n    lastCompositionEndTime = 0;\n  }\n}) : null;\n\n// Global event handlers\nconst onGlobalKeyDown = event => {\n  if (event.key === 'Escape' && !event.isComposing) {\n    const now = Date.now();\n    if (now - lastCompositionEndTime < IME_LOCK_DURATION) {\n      return;\n    }\n    const len = stack.length;\n    for (let i = len - 1; i >= 0; i -= 1) {\n      stack[i].onEsc({\n        top: i === len - 1,\n        event\n      });\n    }\n  }\n};\nconst onGlobalCompositionEnd = () => {\n  lastCompositionEndTime = Date.now();\n};\nfunction attachGlobalEventListeners() {\n  window.addEventListener('keydown', onGlobalKeyDown);\n  window.addEventListener('compositionend', onGlobalCompositionEnd);\n}\nfunction detachGlobalEventListeners() {\n  if (stack.length === 0) {\n    window.removeEventListener('keydown', onGlobalKeyDown);\n    window.removeEventListener('compositionend', onGlobalCompositionEnd);\n  }\n}\nexport default function useEscKeyDown(open, onEsc) {\n  const id = useId();\n  const onEventEsc = useEvent(onEsc);\n  const ensure = () => {\n    if (!stack.find(item => item.id === id)) {\n      stack.push({\n        id,\n        onEsc: onEventEsc\n      });\n    }\n  };\n  const clear = () => {\n    stack = stack.filter(item => item.id !== id);\n  };\n  useMemo(() => {\n    if (open) {\n      ensure();\n    } else if (!open) {\n      clear();\n    }\n  }, [open]);\n  useEffect(() => {\n    if (open) {\n      ensure();\n      // Attach global event listeners\n      attachGlobalEventListeners();\n      return () => {\n        clear();\n        // Remove global event listeners if instances is empty\n        detachGlobalEventListeners();\n      };\n    }\n  }, [open]);\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}